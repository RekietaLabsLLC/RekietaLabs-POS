<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RekietaLabs POS</title>
  <link rel="icon" href="https://rekietalabs.com/IMG_0926.jpeg" type="image/jpeg">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0a0a0a;
      color: #fff;
      text-align: center;
      padding: 50px;
    }

    h1, h2, h3 {
      color: #1753aa;
    }

    .screen { display: none; }
    .active { display: block; }

    #logo {
      width: 120px;
      border-radius: 50%;
      margin-bottom: 20px;
    }

    input, button {
      padding: 10px;
      margin: 10px;
      border-radius: 8px;
      border: 1px solid #1753aa;
      background: #111;
      color: #1753aa;
      font-weight: bold;
    }

    button { cursor: pointer; }

    /* Product Grid */
    #products {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      justify-items: center;
      margin-bottom: 30px;
    }

    #products button {
      width: 100%;
    }

    #cart { margin-top: 20px; }
    .cart-item { margin: 5px 0; }
    .low-stock { color: #ff5555; font-weight: bold; }

    #checkout-total { margin-top: 10px; font-size: 1.2em; color: #fff; }

  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div id="loading-screen" class="screen active">
    <img id="logo" src="https://rekietalabs.com/IMG_0926.jpeg" alt="RekietaLabs Logo">
    <h1>Welcome to RekietaLabs POS</h1>
    <h3>Loading system...</h3>
  </div>

  <!-- Login Screen -->
  <div id="login-screen" class="screen">
    <h2>Enter Employee PIN</h2>
    <input type="password" id="pin-input" placeholder="Enter PIN">
    <button onclick="login()">Login</button>
    <p id="pin-error" style="color:red;"></p>
  </div>

  <!-- POS Screen -->
  <div id="pos-screen" class="screen">
    <h2>Products</h2>
    <div id="products"></div>

    <h2>Cart</h2>
    <div id="cart"></div>
    <div id="checkout-total">Total: $0.00</div>

    <button onclick="checkout()">Checkout</button>
    <button onclick="signOut()">Sign Out</button>
  </div>

  <!-- Checkout Screen -->
  <div id="checkout-screen" class="screen">
    <h2>Checkout</h2>
    <label>Email (optional): <input type="email" id="customer-email"></label><br>
    <button onclick="finishCheckout('Card')">💳 Card</button>
    <button onclick="finishCheckout('Cash')">💵 Cash</button>
    <p id="checkout-result"></p>
    <button onclick="cancelCheckout()">Back to POS</button>
  </div>

<script>
  // API Base (for optional API calls, e.g., PIN validation)
  const API_BASE = window.location.hostname.includes("localhost")
    ? "http://localhost:10000"
    : "https://api.rekietalabs.com";

  let cart = [];
  let stock = [];

  // --- Load stock from local JSON repo ---
  async function loadStock() {
    try {
      const res = await fetch('pos-stock.json');
      stock = await res.json();
    } catch (err) {
      console.error(err);
      alert("Error loading stock.");
    }
  }

  // --- Show only one screen ---
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // --- Startup ---
  window.addEventListener('DOMContentLoaded', async () => {
    await loadStock();
    setTimeout(() => {
      showScreen('login-screen');
    }, 2000);
  });

  // --- PIN Login ---
  const pins = ["7606","4646"];
  function login() {
    const pin = document.getElementById('pin-input').value;
    if (pins.includes(pin)) {
      cart = [];
      renderCart();
      showScreen('pos-screen');
      loadProducts();
    } else {
      document.getElementById('pin-error').innerText = "Invalid PIN";
    }
  }

  function signOut() {
    document.getElementById('pin-input').value = '';
    showScreen('login-screen');
  }

  // --- Products ---
  function loadProducts() {
    const container = document.getElementById('products');
    container.innerHTML = '';
    stock.forEach((item, idx) => {
      const btn = document.createElement('button');
      btn.innerText = `${item.name} - $${item.price.toFixed(2)} (${item.stock} left)`;
      if (item.stock <= 1) btn.innerHTML += ' ⚠️ Low';
      btn.onclick = () => addToCart(idx);
      container.appendChild(btn);
    });
  }

  function addToCart(idx) {
    const item = stock[idx];
    if (item.stock <= 0) return alert("Out of stock!");
    item.stock -= 1;
    const existing = cart.find(c => c.id === item.id);
    if (existing) existing.qty++;
    else cart.push({ ...item, qty: 1 });
    renderCart();
    loadProducts();
  }

  function renderCart() {
    const container = document.getElementById('cart');
    container.innerHTML = '';
    let total = 0;
    cart.forEach(item => {
      total += item.price * item.qty;
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerText = `${item.name} x ${item.qty}`;
      container.appendChild(div);
    });
    document.getElementById('checkout-total').innerText = `Total: $${total.toFixed(2)}`;
  }

  // --- Checkout ---
  function checkout() {
    if(cart.length === 0) return alert("Cart is empty!");
    showScreen('checkout-screen');
  }

  function cancelCheckout() {
    // Return stock to inventory
    cart.forEach(item => {
      const stockItem = stock.find(s => s.id === item.id);
      if(stockItem) stockItem.stock += item.qty;
    });
    cart = [];
    renderCart();
    loadProducts();
    showScreen('pos-screen');
  }

  function finishCheckout(payment) {
    const email = document.getElementById('customer-email').value;
    // Here you would call your POS API to create the receipt
    alert(`Checkout complete with ${payment}. Email: ${email || 'N/A'}`);
    cart = [];
    renderCart();
    loadProducts();
    document.getElementById('customer-email').value = '';
    showScreen('pos-screen');
  }

</script>
</body>
</html>
